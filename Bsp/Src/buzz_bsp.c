#include <stdio.h>
#include "main.h"
#include "tim.h"
#include "buzz_bsp.h"

/**************C调 */
#if 1
 unsigned short int music_tab_c[]={
	0,
	262,294,330,349,392,440,494,//低音1~7 （C4）
	523,587,659,698,784,880,988,//中1~7（C5）
	1046,1175,1318,1397,1568,1760,1976,//高1-7(C6)
	2093,2349,2637,2794,3136,3520,3951//超高1~7(C7)
};
#else 
unsigned short int music_tab_c[]={
	0,
	262,277,294,311,330,349,370,392,415,440,466,494,              //低音1~7 （C4）
	523,554,587,622,659,698,740,784,831,880,932,988,              //中1~7（C5）
	1046,1109,1175,1245,1318,1397,1480,1568,1661,1760,1865,1976,  //高1-7(C6)
	2093,2217,2349,2489,2637,2794,2960,3136,3322,3520,3729,3951    //超高1~7(C7)
};
#endif
/*****小星星乐谱4/4音符**:0-空拍；'\r':-结束符；'1'-1/4音符；'2'-半音符； '3'-3/4音符;'4'-一个音符*;'6'-1.5个音符*/
 unsigned char music_star[85]={
	1,34,1,34,5,34,5,34,
	6,34,6,34,5,38,
	4,34,4,34,3,34,3,34, 
	2,34,2,34,1,38, 
	5,34,5,34,4,34,4,34,	
	3,34,3,34,2,38,
	5,34,5,34,4,34, 4,34,
	3,34,3,34,2,38,
	1,34,1,34,5,34,5,34,
	6,34,6,34,5,38,
	4,34,4,34,3,34,3,34, 
	2,34,2,34,1,38,
	'#'
};
unsigned char music_two_tiger[65]={
	1,34,2,34,3,34,1,34,
	1,34,2,34,3,34,1,34,
	3,34,4,34,5,38, 
	3,34,4,34,5,38, 
	5,32,6,32,5,32,4,32,3,34,1,34,	
	5,32,6,32,5,32,4,32,3,34,1,34,
	2,34,5,34,1,38,
	2,34,5,34,1,38,
	'#'
};
/*****欢乐颂****0:"-"*      */
  unsigned char music_happy[97]={
	3,34,3,34,4,34,5,34, 
	5,34,4,34,3,34,2,34,
	1,34,1,34,2,34,3,34,
	2,36,2,32,1,38,  
	2,34,2,34,3,34,1,34,  
	2,34,3,32,4,32,3,34,1,34,
	2,34,3,32,4,32,3,34,2,34, 
	1,34,2,34,5,34,5,34,
	3,34,3,34,4,34,5,34, 
	5,34,4,34,3,34,2,34,
	1,34,1,34,2,34,3,34,
	2,36,1,32,1,38,	
	'#'
};
/************************************************************************//**
* @brief 蜂鸣器PWM
  * @param volnum 音量0~100；
  * @note  推介频率4k 
  * @retval  
  *****************************************************************************/
void app_beep_pwm(unsigned short int  freq,unsigned char volume)
{ 	
  if(volume!=0&&freq!=0)
  {    
    unsigned int timeUs;
    unsigned short int period;
    if(freq<200) freq=200;
    else if(freq>4000) freq=4000;
    //check freq,timer15 1M clock freq       
    period=(1000000/freq);
    __HAL_TIM_SetAutoreload(&htim15,period-1);//low 0.5k  4kHz  MAX 20kHz
    //duty 1%  100%; 0% close 	
	if(volume<12) timeUs=period>>3;//period/8  12%
	else  timeUs = period >>1;//*volume)/100;	//duty = 50;    
    __HAL_TIM_SetCompare(&htim15,TIM_CHANNEL_1,timeUs-1);
	 //HAL_TIMEx_PWMN_Start(&htim15,TIM_CHANNEL_1);//需要启动 
  }
  else
  {    
	HAL_TIMEx_PWMN_Stop(&htim15,TIM_CHANNEL_1); 
  }
}







